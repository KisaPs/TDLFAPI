# Описание работы на стороне ТД ЛФ
<!--TOC-->
  - [Расширение и рабочее место с работой ИФЗ](#-)
    - [Общее](#)
    - [Настройки работы с заказами](#-)
  - [Обмен заказами](#-)
    - [Выгрузка](#)
<!--/TOC-->
Термины и сокращения
* ЗК - Заказ клиента
* ЗП - Заказ поставщику
## Расширение и рабочее место с работой ИФЗ
### Общее
* Создание рабочего места для работы с ИФЗ
* Создание роли доступа к рабочему месту
### Настройки работы с заказами
* Выбор типа цены при создании ЗП
* Период обрабатываемых ЗК
* Обрабатывать только обособленные товары(bool)
* Контрагент и партнер создаваемых ЗП
---
## Обмен заказами
### Выгрузка
Схема работы выглядит примерно таким образом. И имеют свой недостаток при обмене с ИФЗ. У ИФЗ предполагается, что на каждый заказ клиента создаётся по реализации. Когда плановая работа состоит несколько иначе.

<details> 
<summary> <b> Плановое Объединённые ЗП (многие-ко-многим) (Нажми развернуть) <b> </summary>

```mermaid
graph LR
    %% Заказы поставщику
    ЗП1 --> ЗК1.1
    ЗП1 --> ЗК1.2
    ЗП1 --> ЗК2
    ЗП1 --> ЗК3.1
    ЗП1 --> ЗК3.2
    ЗП1 --> ЗК4.1
    
    ЗП2 --> ЗК4.2
    ЗП2 --> ЗК4.3
    ЗП2 --> НетЗК
    
    %% Связи заказов клиента со сделками
    ЗК1.1 --> Сделка1
    ЗК1.2 --> Сделка1
    
    ЗК3.1 --> Сделка2
    ЗК3.2 --> Сделка2
    
    ЗК4.1 --> Сделка3
    ЗК4.2 --> Сделка3
    ЗК4.3 --> Сделка3
    
    %% У ЗК2 нет сделки
    ЗК2 --> НетСделки[Нет сделки]
    
    %% Группировка для наглядности
    classDef zp fill:#f9f,stroke:#333;
    classDef zk fill:#bbf,stroke:#333;
    classDef deal fill:#bfb,stroke:#333;
    classDef none fill:#fbb,stroke:#333;
    classDef noDeal fill:#ffd,stroke:#333,stroke-dasharray: 5 5;
    
    class ЗП1,ЗП2 zp;
    class ЗК1.1,ЗК1.2,ЗК2,ЗК3.1,ЗК3.2,ЗК4.1,ЗК4.2,ЗК4.3 zk;
    class Сделка1,Сделка2,Сделка3 deal;
    class НетЗК none;
    class НетСделки noDeal;
```
</details> 

<details> 
<summary> <b> ИФЗ Индивидуальные ЗП (один-к-одному) (Нажми развернуть)<b> </summary>

```mermaid
graph LR
    %% Заказы поставщиков
    ЗП1 --> ЗК1.1
    ЗП2 --> ЗК1.2
    ЗП3 --> ЗК2
    ЗП4 --> ЗК3.1
    ЗП5 --> ЗК3.2
    ЗП6 --> ЗК4.1
    ЗП7 --> ЗК4.2
    ЗП8 --> ЗК4.3
    ЗП9 --> НетЗК

    %% Связи заказов клиента со сделками
    ЗК1.1 --> Сделка1
    ЗК1.2 --> Сделка1
    
    ЗК3.1 --> Сделка2
    ЗК3.2 --> Сделка2
    
    ЗК4.1 --> Сделка3
    ЗК4.2 --> Сделка3
    ЗК4.3 --> Сделка3

    %% У ЗК2 нет сделки
    ЗК2 --> НетСделки[Нет сделки]
    
    %% Группировка для наглядности
    classDef zp fill:#f9f,stroke:#333;
    classDef zk fill:#bbf,stroke:#333;
    classDef deal fill:#bfb,stroke:#333;
    classDef none fill:#fbb,stroke:#333;
    classDef noDeal fill:#ffd,stroke:#333,stroke-dasharray: 5 5;
    
    class ЗП1,ЗП2,ЗП3,ЗП4,ЗП5,ЗП6,ЗП7,ЗП8,ЗП9 zp;
    class ЗК1.1,ЗК1.2,ЗК2,ЗК3.1,ЗК3.2,ЗК4.1,ЗК4.2,ЗК4.3 zk;
    class Сделка1,Сделка2,Сделка3 deal;
    class НетЗК none;
    class НетСделки noDeal;

```
</details> 

То есть, затем создаётся реализация по каждому заказу. И могут возникнуть трудности при работе с общим заказом поставщику.

Исходя из диаграмм, полную потребность закрывают только заказы поставщику, их и будем отправлять.
Создавать вручную десяток заказов не имеет смысла автоматизации.
Также предусмотреть ручное создание заказов Поставщику.

Потребуется регламентное задание и регистр, где можно отмечать создание ЗП и статус выгрузки.

Обрабатываем все проведенные ЗК исходя из настроек.
На каждый ЗК создаём ЗП, по типовому правилу "на основании", если такое возможно 1С.
Оно подразумевает, что заполняется сделка, автор, остальные поля и табличная часть, где есть только неотмененные строки и в состоянии к обеспечению. Обособленность берем из настроек.
Если ТЧ в создаваемом заказе пустая, ничего не делаем, переходим к следующему ЗК. Тем самым, проверяем ручное создание ЗП и добавление новых строк в заказ клиента.

Запрос делает сторона ИФЗ, выгружаем данные согласно описанному API.

Комментарий при выгрузке:
* Сделка - номер/код
* ЗП - номер/код
* ЗК - номер/код
* Склад отгрузки - представление. Здесь предстоит подумать, у каждой строки ТЧ товаров имеется склад и он может отличаться, тк это управление отгрузками менеджера.


